
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Import Tools &mdash; LavaFlow 1.1 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="LavaFlow 1.1 documentation" href="index.html" />
    <link rel="next" title="Views" href="views.html" />
    <link rel="prev" title="Client Tools Installation" href="client.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          LavaFlow</a>
        <span class="navbar-text navbar-version pull-left"><b>1.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Web Server Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Client Tools Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Import Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_models.html">Core Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary of Terms</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Import Tools</a><ul>
<li><a class="reference internal" href="#import-key">Import Key</a></li>
<li><a class="reference internal" href="#openlava">Openlava</a><ul>
<li><a class="reference internal" href="#initial-import">Initial Import</a></li>
<li><a class="reference internal" href="#normal-import">Normal Import</a></li>
<li><a class="reference internal" href="#lava-import-openlava">lava-import-openlava</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="client.html" title="Previous Chapter: Client Tools Installation"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Client Tools Ins...</span>
    </a>
  </li>
  <li>
    <a href="views.html" title="Next Chapter: Views"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Views &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/import.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="import-tools">
<h1>Import Tools<a class="headerlink" href="#import-tools" title="Permalink to this headline">¶</a></h1>
<p>For each type of cluster that LavaFlow supports, there is also a corresponding set of tooling to import data form that
cluster.  The usage of which is documented below.</p>
<div class="section" id="import-key">
<h2>Import Key<a class="headerlink" href="#import-key" title="Permalink to this headline">¶</a></h2>
<img alt="_images/create_import_key.png" class="align-center" src="_images/create_import_key.png" style="width: 600px;" />
<p>Regardless of how you are importing data, you will require a shared key, this is stored in the ImportKey table, and
is part of the admin interface.  Log into the django admin interface, and click on the ImportKey item under the
lavaFlow section.</p>
<p>Create a new ImportKey, setting the client_key to the value of the shared key, it is recommended that you use a
different key for each cluster, however there is no hard requirement to do so.</p>
</div>
<div class="section" id="openlava">
<h2>Openlava<a class="headerlink" href="#openlava" title="Permalink to this headline">¶</a></h2>
<p>data from lsb.acct and lsb.events needs to be imported into LavaFlow, this is done using lava-import-openlava, a python
script that reads the log file using the python bindings for openlava, and uploads them using another API call to the
openlava web server.</p>
<div class="section" id="initial-import">
<h3>Initial Import<a class="headerlink" href="#initial-import" title="Permalink to this headline">¶</a></h3>
<p>At first, it is likely you will have various log files, some of which have been rotated by the scheduler, others that
perhaps are from an older cluster that has been retired and you wish to import historical data.  In that case it is
generally easiest to just run lava-import-python on each file once before setting up any recurring import.</p>
<p>For each cluster you will typically have at least one lsb.acct file, and many lsb.events files, these are rotated to
lsb.events.n where n is a number indicating the index of the file, the bigger the number, the older the data in the
file.</p>
<p>If you are on an active openlava cluster, the following example will import all existing data:</p>
<div class="highlight-python"><pre>$ for i in $LSF_ENVDIR/../work/logdir/lsb.events* $LSF_ENVDIR/../work/logdir/lsb.acct*  ;
  do
   lava-import-openlava --chunk_size 500 --log_level=info $i http://MyLavaServer/lavaflow topSecretKey
  done</pre>
</div>
<p>In this case, the chunk_size is set slightly higher than normal which will give a faster import, however if you make
this too high, it is possible that the server will timeout when importing, which will result in a fatal error.</p>
<p>If you are importing data from a machine that is not part of the openlava cluster, or you want to specify a specific
name for the cluster other than what is reported by the scheduling system, you should use the &#8211;cluster_name option.</p>
</div>
<div class="section" id="normal-import">
<h3>Normal Import<a class="headerlink" href="#normal-import" title="Permalink to this headline">¶</a></h3>
<p>Once you have historical data imported, you need to run the import script with the &#8211;tail_log option, this will read
the log file to completion, and wait on new data.  If the log file is rotated, it will automatically load the new file
each time.</p>
<p>These should, ideally be started at system boot.</p>
<p>If you have a cluster that has a very low rate of job turnover, it is advisable to reduce the chunk_size so that
data is uploaded more often.:</p>
<div class="highlight-python"><pre>lava-import-openlava --chunk_size 50 --tail_log --log_level=warn $LSF_ENVDIR/../work/logdir/lsb.events http://MyLavaServer/lavaflow topSecretKey
lava-import-openlava --chunk_size 50 --tail_log --log_level=warn $LSF_ENVDIR/../work/logdir/lsb.events http://MyLavaServer/lavaflow topSecretKey</pre>
</div>
<p>If you have issues with network reliability, you may wish to use the &#8211;retry_forever which will never give up in the
event that the server does not respond.</p>
</div>
<div class="section" id="lava-import-openlava">
<h3>lava-import-openlava<a class="headerlink" href="#lava-import-openlava" title="Permalink to this headline">¶</a></h3>
<p>Reads openlava log files and uploads them.  Will read and attempt to upload all entries in the file.
This is not desirable if you have large logfiles and want to upload regularly, for that you should use
logtail or some other utility to only read entries that have not yet been uploaded.  There is no harm in
re-uploading, but it is time expensive.</p>
<dl class="option">
<dt>
<tt class="descname">log_file</tt></dt>
<dd></dd></dl>

<p>The path to the log file to read, should be one of lsb.acct or lsb.events*</p>
<dl class="option">
<dt>
<tt class="descname">url</tt></dt>
<dd></dd></dl>

<p>Fully qualified URL to the lavaflow server.</p>
<dl class="option">
<dt>
<tt class="descname">key</tt></dt>
<dd></dd></dl>

<p>Pre shared key that will be used to verify the client has permission to publish to the server.</p>
<dl class="option">
<dt>
<tt class="descname">tail_log</tt></dt>
<dd></dd></dl>

<p>When enabled, will not exit when the end of the input file is reached.  Instead, it will wait for new data,
or if the file is rotated, reopen the file and continue reading.</p>
<dl class="option">
<dt>
<tt class="descname">cluster_name</tt></dt>
<dd></dd></dl>

<p>Optional name of the cluster, if no cluster name is specified, will attempt to infer cluster name from openlava
directly.</p>
<dl class="option">
<dt>
<tt class="descname">chunk_size</tt></dt>
<dd></dd></dl>

<p>Number of records to group together before sending to server.</p>
<dl class="option">
<dt>
<tt class="descname">log_level</tt></dt>
<dd></dd></dl>

<p>Log level to use, can be one of debug, info, warn, error, critical.</p>
<p>When enabled, will not exit when the end of the input file is reached.  Instead, it will wait for new data,
or if the file is rotated, reopen the file and continue reading.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, David Irvine.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>